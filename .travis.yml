dist: trusty
sudo: required
language: node_js

node_js:
  - "6"

os:
  - linux

addons:
  jwt:
    secure: "D9LsbX3nHLl55MXrXdLv6sJse7vEsUTHyxxxJlLwOxSUrlOLuhyE0DrvUVVvOvNjHbwgenmqdGFtQ8Gsx9q+C1psM/VtMoiEViLkxFzczAlElNqoD5nGM9/988aFzaipzvce13m5CjCaEjdZmUepc3JVgY5jFyW949JVOPLY7lZMu6jJgDXX//xZ6SqCZ+y0GSz/zE7nN8VhMceg7/elLeW63A8mROXGfwe4plssQ3JP6QoxlqBeaS97zRytX6b10oaAddtNpuHG53hIa/ZYGIfLvuVKKhdY3WhuuwF9m4/h+xgMbMjAuj1yoFdQ/2TCeORIV2/osuvkVHqZnmge523+endbnOzkaIb1q67v/t6tJ9gHrTz+8lM6Dj3A9Wj129x1fDsrEJOH74e0q+NvO0Qqz8YXLuwbh2boQYhUsgOhsFZ+MdMONa7+bqNUkX8IYyb1Xfj7WgLcuFn0RhwtTIhLFDwDWOBLhmdcvZPGbU3RrGS4m53wq/ZlMzDpwU8eFT+2s1BpYrnLFrTh9kJrL61KycvJgG7xPgS7g64rLFdtyV0wXVBqZ3XdiVzlARG9XABbCHAePPXJV6ggFPThLkU8ZKlgSc/eOTQY30lSrXj/8ws3+/pzgyzypy0Mm10LwkGmL5pBlQsT4q18l9Aj9WvzBzZbiJPukBgw5Rm9bpU="

env:
  global:
  - LOGS_DIR=/tmp/ngx-mime-build/logs
  - BROWSER_PROVIDER_READY_FILE=/tmp/ngx-mime-build/readyfile

before_install:
  # Use a virtual display.
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  # Install latest chrome.
  - export CHROME_BIN=/usr/bin/google-chrome
  - sudo apt-get update
  - sudo apt-get install -y libappindicator1 fonts-liberation
  - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  - sudo dpkg -i google-chrome*.deb

install:
  - npm install

before_script:
 - mkdir -p $LOGS_DIR
 - chmod +x ./scripts/ci/build-and-test.sh
 - chmod +x ./scripts/saucelabs/start-tunnel.sh
 - chmod +x ./scripts/saucelabs/wait-tunnel.sh
 - chmod +x ./scripts/saucelabs/stop-tunnel.sh

script:
  - ./scripts/ci/build-and-test.sh

before_deploy:
  - cd dist

deploy:
  provider: npm
  api_key:
    secure: "LVwEY2LWJq02Iglvg6ZAUAENjIWX/OJPE6Z7OH30LFeH8l+Fmhl9JzMB3KPhMRcykv1H6LI60IC8ds/nd+wGny895xT0QW0y0mbp9edh3C9DzOYZIxPs5aUpjBRFevQUk3ADlr17KlJoNYL2OL7cNPKiJi5NIK+JRd1PZeey6NZJxJNaobdUQTZLOlMjkec2e3CDPpnp6VtU/XyzAUSp8Hb4fDRpdfHDszzXmQXNEAik3cEIzMDQeXLP0sWRaEdFjAWK8W3Ad+u1sYIUYF+bQLE3mh+JAc8GyOJrDZXRspFLwSHuLExMuHkZvCdoW5ass/FGAxeQZpaj7GtSNXXxOtmP/1QO/Xe0amTrwEoYRvp5gWcqaSqMF4hgLYvriBXYk1IOh1dtrBj+hGapFxLImM9UAqT0ifTLXqT+F+tWB89oVH/i3nH+cwdmtAi1OqOBmgi/D0sMvTrZ0gInSK9lUwGWOF2gzJvm8AjX+iyuiOqMpFU8kYvHhMoWvFvlZdGPWoMW0bvqyRVK8jf1D/E2t+nh7DRNQZpZMBtE0MEc+3Ne26O+W9+koIySD56RKNYsQb59SX3/bhx8LLViVMPNDI6G3JzTf+jS3F3GAo7XTV/leA06/xm3gKTLb5wEctvtDZyFvy5E4KhTmQgQL0QUVmvvsiFKd4r4cJ9UodA2V28="
  email: ronny.mikalsen@nasjonalbiblioteket.org
  skip_cleanup: true
  on:
    branch: master
    tags: true